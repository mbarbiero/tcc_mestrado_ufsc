<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Quadra 0054 - Capanema PR</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; overflow: hidden; width: 100vw; height: 100vh; }
        svg { width: 100%; height: 100%; display: block; }

        .lote { fill: #e3f2fd; stroke: #455a64; stroke-width: 1.2; transition: all 0.2s; cursor: pointer; }
        .lote:hover { fill: #1a73e8 !important; stroke: #0d47a1; stroke-width: 2.5; }
        
        .lote-text { font-size: 14px; fill: #0d47a1; font-weight: 900; pointer-events: none; text-anchor: middle; }
        .dim-text-inner { font-size: 11px; fill: #37474f; font-weight: bold; pointer-events: none; text-anchor: middle; }
        
        /* Cota Norte em destaque para garantir visibilidade */
        .quadra-dim-total { font-size: 15px; fill: #d35400; font-weight: 800; text-anchor: middle; }

        g:hover .lote-text, g:hover .dim-text-inner { fill: #ffffff !important; }

        .tooltip {
            position: absolute; padding: 12px; background: rgba(32, 33, 36, 0.98);
            color: white; border-radius: 8px; font-size: 15px; display: none; 
            pointer-events: none; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border: 1px solid #1a73e8; line-height: 1.4;
        }

        .header-institucional {
            position: absolute; top: 0; left: 0; width: 100%; padding: 20px;
            text-align: center; background: white; border-bottom: 1px solid #e0e0e0;
            pointer-events: none; z-index: 10;
        }
    </style>
</head>
<body>

<div class="header-institucional">
    <h1 style="color: #263238; font-size: 20px; margin-bottom: 2px;">Quadra 0054</h1>
    <p style="color: #1a73e8; font-weight: 600; font-size: 13px;">Capanema - PR - 2026</p>
</div>

<div id="tooltip" class="tooltip"></div>
<svg id="quadraSvg"></svg>

<script>
    const dadosCsv = `COD_MUNICIPIO;COD_UNICO_ENDERECO;ID_QUADRA;NOM_LOGRADOURO;NUM_ENDERECO;NOM_LOGRADOURO_ADJACENTE;DIM_TESTADA;DIM_PROFUNDIDADE
4104501;01.03.002.3.0054.1200;01.03.002.3.0054;RUA SANTA CATARINA;3612;;20;45
4104501;01.03.002.3.0054.1100;01.03.002.3.0054;RUA SANTA CATARINA;3632;;20;45
4104501;01.03.002.3.0054.100A;01.03.002.3.0054;RUA SANTA CATARINA;3646;;10;45
4104501;01.03.002.3.0054.1000;01.03.002.3.0054;RUA SANTA CATARINA;3650;;10;45
4104501;01.03.002.3.0054.0900;01.03.002.3.0054;RUA CARAMURUS;447;;20;50
4104501;01.03.002.3.0054.0800;01.03.002.3.0054;AV. UBIRAJARAS;412;;20;50
4104501;01.03.002.3.0054.070A;01.03.002.3.0054;AV. PARANA;615;;10;45
4104501;01.03.002.3.0054.0700;01.03.002.3.0054;AV. PARANA;603;;10;45
4104501;01.03.002.3.0054.0600;01.03.002.3.0054;AV. PARANA;625;;20;45
4104501;01.03.002.3.0054.0500;01.03.002.3.0054;AV. PARANA;655;;20;45
4104501;01.03.002.3.0054.04AA;01.03.002.3.0054;RUA CARAMURUS;415;;11.25;20
4104501;01.03.002.3.0054.040A;01.03.002.3.0054;RUA CARAMURUS;427;;11.25;20
4104501;01.03.002.3.0054.0400;01.03.002.3.0054;RUA SANTA CATARINA;3590;RUA CARAMURUS;20;22.5
4104501;01.03.002.3.0054.0300;01.03.002.3.0054;AV. UBIRAJARAS;380 ;RUA SANTA CATARINA;45;20
4104501;01.03.002.3.0054.020A;01.03.002.3.0054;RUA CARAMURUS;461;;15;20
4104501;01.03.002.3.0054.0200;01.03.002.3.0054;AV. PARANA;589;RUA CARAMURUS;20;30
4104501;01.03.002.3.0054.010A;01.03.002.3.0054;AV. PARANA;665;AV. UBIRAJARAS;20;22.5
4104501;01.03.002.3.0054.0100;01.03.002.3.0054;AV. UBIRAJARAS;438;;22.5;20`;

    function render() {
        const lotes = dadosCsv.split('\n').slice(1).map(l => {
            const c = l.split(';');
            return { id: c[1], rua: c[3].trim(), num: c[4].trim(), adj: c[5].trim(), t: parseFloat(c[6]), p: parseFloat(c[7]) };
        });

        const svg = document.getElementById('quadraSvg');
        const tooltip = document.getElementById('tooltip');
        
        // Ajuste de escala e posicionamento
        const ESC = 6.4; 
        const OFF_X = (window.innerWidth / 2) - (55 * ESC);
        // OFF_Y ajustado para dar 30px extras de folga para a cota norte
        const OFF_Y = (window.innerHeight / 2) - (60 * ESC) + 60;

        function drawLote(x, y, w, h, info) {
            const displayTestada = info.adj ? info.t + info.p : info.t;
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x); rect.setAttribute("y", y);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("class", "lote");

            rect.addEventListener('mouseover', () => {
                tooltip.style.display = 'block';
                tooltip.innerHTML = `<strong>${info.rua}, ${info.num}</strong><br>Medida: ${displayTestada}m x ${info.p}m`;
            });
            rect.addEventListener('mousemove', (e) => {
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
            });
            rect.addEventListener('mouseout', () => tooltip.style.display = 'none');

            const tId = document.createElementNS("http://www.w3.org/2000/svg", "text");
            tId.setAttribute("x", x + w/2); tId.setAttribute("y", y + h/2 - 4);
            tId.setAttribute("class", "lote-text");
            tId.textContent = info.id.split('.').pop();

            const tDim = document.createElementNS("http://www.w3.org/2000/svg", "text");
            tDim.setAttribute("x", x + w/2); tDim.setAttribute("y", y + h/2 + 14);
            tDim.setAttribute("class", "dim-text-inner");
            tDim.textContent = `${displayTestada}x${info.p}`;

            g.appendChild(rect); g.appendChild(tId); g.appendChild(tDim);
            svg.appendChild(g);
        }

        const l010A = lotes.find(l => l.id.endsWith('.010A'));
        const l0300 = lotes.find(l => l.id.endsWith('.0300'));
        const l0200 = lotes.find(l => l.id.endsWith('.0200'));

        let curX = OFF_X;
        lotes.filter(l => l.rua === 'AV. PARANA').sort((a,b) => b.num - a.num).forEach(l => {
            drawLote(curX, OFF_Y, l.t * ESC, l.p * ESC, l);
            curX += l.t * ESC;
        });

        let curY = OFF_Y + (l010A.p * ESC);
        ['.0100', '.0800', '.0300'].forEach(sfx => {
            const l = lotes.find(item => item.id.endsWith(sfx));
            if(l) {
                drawLote(OFF_X, curY, l.p * ESC, l.t * ESC, l);
                curY += l.t * ESC;
            }
        });

        const posX_Leste = curX; 
        let curY_Leste = OFF_Y + (l0200.p * ESC);
        ['.020A', '.0900', '.040A', '.04AA'].forEach(sfx => {
            const l = lotes.find(item => item.id.endsWith(sfx));
            if(l) {
                drawLote(posX_Leste - (l.p * ESC), curY_Leste, l.p * ESC, l.t * ESC, l);
                curY_Leste += l.t * ESC;
            }
        });

        let sulX = OFF_X + (l0300.p * ESC);
        lotes.filter(l => l.rua === 'RUA SANTA CATARINA' && !l.id.endsWith('.0400'))
             .sort((a,b) => b.num - a.num).forEach(l => {
                drawLote(sulX, curY - (l.p * ESC), l.t * ESC, l.p * ESC, l);
                sulX += l.t * ESC;
             });

        const l0400 = lotes.find(l => l.id.endsWith('.0400'));
        drawLote(posX_Leste - (l0400.t * ESC), curY - (l0400.p * ESC), l0400.t * ESC, l0400.p * ESC, l0400);

        // --- COTAS TOTAIS ---
        const realW = curX - OFF_X; const realH = curY - OFF_Y;
        function drawCota(x, y, txt, rot = 0) {
            const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t.setAttribute("class", "quadra-dim-total");
            if(rot !== 0) t.setAttribute("transform", `translate(${x},${y}) rotate(${rot})`);
            else { t.setAttribute("x", x); t.setAttribute("y", y); }
            t.textContent = txt; svg.appendChild(t);
        }
        
        // Cota Norte - Subi mais 10px (total -25) para garantir visibilidade
        drawCota(OFF_X + realW/2, OFF_Y - 25, `${(realW/ESC).toFixed(2)}m`);
        
        drawCota(OFF_X + realW/2, curY + 35, `${(realW/ESC).toFixed(2)}m`);
        drawCota(OFF_X - 45, OFF_Y + realH/2, `${(realH/ESC).toFixed(2)}m`, -90);
        drawCota(posX_Leste + 55, OFF_Y + realH/2, `${(realH/ESC).toFixed(2)}m`, 90);
    }

    window.onload = render;
    window.onresize = () => { svg.innerHTML = ''; render(); };
</script>
</body>
</html>