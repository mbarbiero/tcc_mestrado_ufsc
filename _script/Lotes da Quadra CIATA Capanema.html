<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Visualizador de Quadra - Ordem Decrescente</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f8f9fa; margin: 20px; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); max-width: 1100px; margin: auto; }
        h2 { color: #202124; border-left: 5px solid #1a73e8; padding-left: 15px; margin-bottom: 5px; }
        p { color: #5f6368; margin-bottom: 20px; }
        
        #canvas-container { 
            background: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px;
            display: flex; justify-content: center; align-items: center; padding: 40px;
        }

        svg { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        
        .lote { fill: #fff3e0; stroke: #444; stroke-width: 1.2; transition: all 0.2s; cursor: pointer; }
        .lote:hover { fill: #ffe0b2; stroke: #1a73e8; }
        .lote-text { font-size: 9px; fill: #202124; pointer-events: none; font-weight: 700; }
        .dim-text { font-size: 7px; fill: #5f6368; pointer-events: none; }
        
        .legenda { margin-top: 25px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .face-label { font-size: 11px; font-weight: bold; padding: 8px; border-radius: 6px; color: white; text-align: center; text-transform: uppercase; }
        
        .norte { background: #1a73e8; } .leste { background: #34a853; }
        .sul { background: #f9ab00; } .oeste { background: #ea4335; }
        
        .tooltip {
            position: absolute; padding: 10px; background: rgba(32, 33, 36, 0.95);
            color: white; border-radius: 6px; font-size: 12px; display: none; 
            pointer-events: none; z-index: 1000; line-height: 1.4;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Configuração de Quadra 0054</h2>
    <p>Sentido de numeração: <b>Decrescente (Esq → Dir)</b> nas faces horizontais.</p>

    <div id="canvas-container">
        <svg id="quadraSvg"></svg>
    </div>

    <div class="legenda">
        <div class="face-label norte">Norte: Av. Paraná (665-589)</div>
        <div class="face-label leste">Leste: R. Caramurus</div>
        <div class="face-label sul">Sul: R. Sta Catarina (3650-3590)</div>
        <div class="face-label oeste">Oeste: Av. Ubirajaras</div>
    </div>
</div>

<div id="tooltip" class="tooltip"></div>

<script>
    const dadosCsv = `COD_MUNICIPIO;COD_UNICO_ENDERECO;ID_QUADRA;NOM_LOGRADOURO;NUM_ENDERECO;NOM_LOGRADOURO_ADJACENTE;DIM_TESTADA;DIM_PROFUNDIDADE
4104501;01.03.002.3.0054.1200;01.03.002.3.0054;RUA SANTA CATARINA;3612;;20;45
4104501;01.03.002.3.0054.1100;01.03.002.3.0054;RUA SANTA CATARINA;3632;;20;45
4104501;01.03.002.3.0054.100A;01.03.002.3.0054;RUA SANTA CATARINA;3646;;10;45
4104501;01.03.002.3.0054.1000;01.03.002.3.0054;RUA SANTA CATARINA;3650;;10;45
4104501;01.03.002.3.0054.0900;01.03.002.3.0054;RUA CARAMURUS;447;;20;45
4104501;01.03.002.3.0054.0800;01.03.002.3.0054;AV. UBIRAJARAS;412;;20;45
4104501;01.03.002.3.0054.070A;01.03.002.3.0054;AV. PARANA;615;;10;45
4104501;01.03.002.3.0054.0700;01.03.002.3.0054;AV. PARANA;603;;10;45
4104501;01.03.002.3.0054.0600;01.03.002.3.0054;AV. PARANA;625;;20;45
4104501;01.03.002.3.0054.0500;01.03.002.3.0054;AV. PARANA;655;;20;45
4104501;01.03.002.3.0054.04AA;01.03.002.3.0054;RUA CARAMURUS;415;;11.25;22.5
4104501;01.03.002.3.0054.040A;01.03.002.3.0054;RUA CARAMURUS;427;;11.25;22.5
4104501;01.03.002.3.0054.0400;01.03.002.3.0054;RUA SANTA CATARINA;3590;RUA CARAMURUS;20;22.5
4104501;01.03.002.3.0054.0300;01.03.002.3.0054;AV. UBIRAJARAS;380 ;RUA SANTA CATARINA;45;20
4104501;01.03.002.3.0054.020A;01.03.002.3.0054;RUA CARAMURUS;461;;20;15
4104501;01.03.002.3.0054.0200;01.03.002.3.0054;AV. PARANA;589;RUA CARAMURUS;20;30
4104501;01.03.002.3.0054.010A;01.03.002.3.0054;AV. PARANA;665;AV. UBIRAJARAS;20;20
4104501;01.03.002.3.0054.0100;01.03.002.3.0054;AV. UBIRAJARAS;438;;22.5;20`;

    function desenhar() {
        const linhas = dadosCsv.split('\n').slice(1);
        const lotes = linhas.map(l => {
            const c = l.split(';');
            return { id: c[1], rua: c[3].trim(), num: parseInt(c[4]), adj: c[5], t: parseFloat(c[6]), p: parseFloat(c[7]) };
        });

        const svg = document.getElementById('quadraSvg');
        const ESCALA = 7;
        const OFFSET = 50;
        const LARGURA_TOTAL = 110 * ESCALA;
        const ALTURA_TOTAL = 120 * ESCALA;

        svg.setAttribute('width', LARGURA_TOTAL + 100);
        svg.setAttribute('height', ALTURA_TOTAL + 100);

        // REGRA: Ordem decrescente nas testadas horizontais
        const faceNorte = lotes.filter(l => l.rua === 'AV. PARANA').sort((a,b) => b.num - a.num);
        const faceSul = lotes.filter(l => l.rua === 'RUA SANTA CATARINA').sort((a,b) => b.num - a.num);
        const faceLeste = lotes.filter(l => l.rua === 'RUA CARAMURUS').sort((a,b) => a.num - b.num);
        const faceOeste = lotes.filter(l => l.rua === 'AV. UBIRAJARAS').sort((a,b) => a.num - b.num);

        const tooltip = document.getElementById('tooltip');

        function desenharLote(x, y, w, h, info) {
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x); rect.setAttribute("y", y);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("class", "lote");
            
            rect.addEventListener('mouseover', (e) => {
                tooltip.style.display = 'block';
                tooltip.innerHTML = `<b>Lote:</b> ${info.id}<br><b>Endereço:</b> ${info.rua}, ${info.num}<br><b>Testada:</b> ${info.t}m | <b>Prof.:</b> ${info.p}m`;
            });
            rect.addEventListener('mousemove', (e) => {
                tooltip.style.left = (e.pageX + 15) + 'px'; tooltip.style.top = (e.pageY + 15) + 'px';
            });
            rect.addEventListener('mouseout', () => tooltip.style.display = 'none');

            const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
            txt.setAttribute("x", x + w/2); txt.setAttribute("y", y + h/2 - 2);
            txt.setAttribute("text-anchor", "middle"); txt.setAttribute("class", "lote-text");
            txt.textContent = info.id.split('.').pop();

            const dim = document.createElementNS("http://www.w3.org/2000/svg", "text");
            dim.setAttribute("x", x + w/2); dim.setAttribute("y", y + h/2 + 8);
            dim.setAttribute("text-anchor", "middle"); dim.setAttribute("class", "dim-text");
            dim.textContent = `${info.t}x${info.p}`;

            g.appendChild(rect); g.appendChild(txt); g.appendChild(dim);
            svg.appendChild(g);
        }

        // --- RENDERIZAÇÃO ---

        // 1. NORTE (AV. PARANÁ): Inicia em 665 à esquerda, termina em 589 à direita
        let curX = OFFSET;
        faceNorte.forEach(l => {
            desenharLote(curX, OFFSET, l.t * ESCALA, l.p * ESCALA, l);
            curX += l.t * ESCALA;
        });

        // 2. SUL (RUA SANTA CATARINA): Inicia em 3650 à esquerda, termina em 3590 à direita
        curX = OFFSET;
        faceSul.forEach(l => {
            desenharLote(curX, OFFSET + ALTURA_TOTAL - (l.p * ESCALA), l.t * ESCALA, l.p * ESCALA, l);
            curX += l.t * ESCALA;
        });

        // 3. OESTE (AV. UBIRAJARAS) e LESTE (RUA CARAMURUS) - Miolo da quadra
        // Posicionamento vertical para preencher o centro
        let curY = OFFSET + (30 * ESCALA); // Abaixo dos lotes de esquina do norte
        faceOeste.forEach(l => {
            if(l.adj !== "") return; // Pula os que já foram tratados ou são corners especiais
            desenharLote(OFFSET, curY, l.p * ESCALA, l.t * ESCALA, l);
            curY += l.t * ESCALA;
        });

        curY = OFFSET + (45 * ESCALA);
        faceLeste.forEach(l => {
            if(l.adj !== "") return;
            desenharLote(OFFSET + LARGURA_TOTAL - (l.p * ESCALA), curY, l.p * ESCALA, l.t * ESCALA, l);
            curY += l.t * ESCALA;
        });
        
        // Ajuste manual de lotes específicos de esquina (ex: 0300) que não entraram nos loops
        const lote0300 = lotes.find(l => l.id.endsWith('.0300'));
        desenharLote(OFFSET, OFFSET + ALTURA_TOTAL - (20 * ESCALA) - (45 * ESCALA), 20 * ESCALA, 45 * ESCALA, lote0300);
    }

    window.onload = desenhar;
</script>

</body>
</html>