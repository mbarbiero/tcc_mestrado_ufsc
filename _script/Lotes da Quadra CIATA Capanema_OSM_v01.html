<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Quadra 0054 Ajustada com OSM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; overflow: hidden; width: 100vw; height: 100vh; }
        svg { width: 100%; height: 100%; display: block; }

        .lote { fill: #e3f2fd; stroke: #455a64; stroke-width: 1.2; transition: all 0.2s; cursor: pointer; }
        .lote:hover { fill: #1a73e8 !important; stroke: #0d47a1; stroke-width: 2.5; }
        
        .lote-text { font-size: 14px; fill: #0d47a1; font-weight: 900; pointer-events: none; text-anchor: middle; }
        .dim-text-inner { font-size: 10px; fill: #546e7a; font-weight: bold; pointer-events: none; text-anchor: middle; }
        .num-predial { font-size: 9px; fill: #e53935; font-weight: bold; pointer-events: none; }
        
        .quadra-dim-total { font-size: 14px; fill: #d35400; font-weight: 800; text-anchor: middle; }
        .rua-label { font-size: 12px; fill: #78909c; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; text-anchor: middle; }

        /* GIRO DE 15 GRAUS SOLICITADO */
        #mainGroup {
            transform: rotate(15deg);
            transform-origin: center center;
        }

        .tooltip {
            position: absolute; padding: 12px; background: rgba(32, 33, 36, 0.98);
            color: white; border-radius: 8px; font-size: 14px; display: none; 
            z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.4); border: 1px solid #1a73e8;
        }

        .header-institucional {
            position: absolute; top: 0; left: 0; width: 100%; padding: 15px;
            text-align: center; background: white; border-bottom: 1px solid #e0e0e0;
            z-index: 10;
        }
    </style>
</head>
<body>

<div class="header-institucional">
    <h1 style="color: #263238; font-size: 20px;">Quadra 0054 Ajustada com OSM</h1>
    <p style="color: #1a73e8; font-weight: 600; font-size: 13px;">Capanema - PR - 2026</p>
</div>

<div id="tooltip" class="tooltip"></div>

<svg id="quadraSvg">
    <g id="mainGroup"></g>
    
    <g id="rosaVentos">
        <circle r="25" fill="white" stroke="#cfd8dc" stroke-width="1" fill-opacity="0.9"/>
        <path d="M0 -22 L6 0 L0 -3 L-6 0 Z" fill="#d32f2f" />
        <path d="M0 22 L6 0 L0 -3 L-6 0 Z" fill="#263238" />
        <path d="M22 0 L0 6 L3 0 L0 -6 Z" fill="#455a64" />
        <path d="M-22 0 L0 6 L-3 0 L0 -6 Z" fill="#455a64" />
        <text y="-28" font-size="11" font-weight="bold" text-anchor="middle" fill="#263238">N</text>
    </g>
</svg>

<script>
    const dadosCsv = `COD_MUNICIPIO;COD_UNICO_ENDERECO;ID_QUADRA;NOM_LOGRADOURO;NUM_ENDERECO;NOM_LOGRADOURO_ADJACENTE;DIM_TESTADA;DIM_PROFUNDIDADE
4104501;01.03.002.3.0054.1200;01.03.002.3.0054;RUA SANTA CATARINA;3612;;20;45
4104501;01.03.002.3.0054.1100;01.03.002.3.0054;RUA SANTA CATARINA;3632;;20;45
4104501;01.03.002.3.0054.100A;01.03.002.3.0054;RUA SANTA CATARINA;3646;;10;45
4104501;01.03.002.3.0054.1000;01.03.002.3.0054;RUA SANTA CATARINA;3650;;10;45
4104501;01.03.002.3.0054.0900;01.03.002.3.0054;RUA CARAMURUS;447;;20;50
4104501;01.03.002.3.0054.0800;01.03.002.3.0054;AV. UBIRAJARAS;412;;20;50
4104501;01.03.002.3.0054.070A;01.03.002.3.0054;AV. PARANA;615;;10;45
4104501;01.03.002.3.0054.0700;01.03.002.3.0054;AV. PARANA;603;;10;45
4104501;01.03.002.3.0054.0600;01.03.002.3.0054;AV. PARANA;625;;20;45
4104501;01.03.002.3.0054.0500;01.03.002.3.0054;AV. PARANA;655;;20;45
4104501;01.03.002.3.0054.04AA;01.03.002.3.0054;RUA CARAMURUS;415;;11.25;20
4104501;01.03.002.3.0054.040A;01.03.002.3.0054;RUA CARAMURUS;427;;11.25;20
4104501;01.03.002.3.0054.0400;01.03.002.3.0054;RUA SANTA CATARINA;3590;RUA CARAMURUS;20;22.5
4104501;01.03.002.3.0054.0300;01.03.002.3.0054;AV. UBIRAJARAS;380 ;RUA SANTA CATARINA;45;20
4104501;01.03.002.3.0054.020A;01.03.002.3.0054;RUA CARAMURUS;461;;15;20
4104501;01.03.002.3.0054.0200;01.03.002.3.0054;AV. PARANA;589;RUA CARAMURUS;20;30
4104501;01.03.002.3.0054.010A;01.03.002.3.0054;AV. PARANA;665;AV. UBIRAJARAS;20;22.5
4104501;01.03.002.3.0054.0100;01.03.002.3.0054;AV. UBIRAJARAS;438;;22.5;20`;

    function render() {
        const lotes = dadosCsv.split('\n').slice(1).map(l => {
            const c = l.split(';');
            return { id: c[1], rua: c[3].trim(), num: c[4].trim(), adj: c[5].trim(), t: parseFloat(c[6]), p: parseFloat(c[7]) };
        });

        const mainGroup = document.getElementById('mainGroup');
        const rosa = document.getElementById('rosaVentos');
        const ESC = 6.0; 
        
        const OFF_X = (window.innerWidth / 2) - (55 * ESC);
        const OFF_Y = (window.innerHeight / 2) - (60 * ESC) + 60;

        function drawLote(x, y, w, h, info, orientation) {
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x); rect.setAttribute("y", y);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("class", "lote");

            rect.onmouseover = (e) => {
                const tt = document.getElementById('tooltip');
                tt.style.display = 'block';
                tt.innerHTML = `<strong>${info.rua}, ${info.num}</strong><br>Área: ${(info.t * info.p).toFixed(2)} m²`;
            };
            rect.onmousemove = (e) => {
                const tt = document.getElementById('tooltip');
                tt.style.left = (e.clientX + 10) + 'px'; tt.style.top = (e.clientY + 10) + 'px';
            };
            rect.onmouseout = () => document.getElementById('tooltip').style.display = 'none';

            const tId = document.createElementNS("http://www.w3.org/2000/svg", "text");
            tId.setAttribute("x", x + w/2); tId.setAttribute("y", y + h/2 - 2);
            tId.setAttribute("class", "lote-text");
            tId.textContent = info.id.split('.').pop();

            const tDim = document.createElementNS("http://www.w3.org/2000/svg", "text");
            tDim.setAttribute("x", x + w/2); tDim.setAttribute("y", y + h/2 + 12);
            tDim.setAttribute("class", "dim-text-inner");
            tDim.textContent = `${info.t}x${info.p}`;

            const nP = document.createElementNS("http://www.w3.org/2000/svg", "text");
            nP.setAttribute("class", "num-predial");
            if(orientation === 'N') { nP.setAttribute("x", x + 2); nP.setAttribute("y", y + 10); }
            else if(orientation === 'S') { nP.setAttribute("x", x + 2); nP.setAttribute("y", y + h - 3); }
            else if(orientation === 'W') { nP.setAttribute("x", x + 2); nP.setAttribute("y", y + 10); }
            else { nP.setAttribute("x", x + w - 22); nP.setAttribute("y", y + 10); }
            nP.textContent = info.num;

            g.appendChild(rect); g.appendChild(tId); g.appendChild(tDim); g.appendChild(nP);
            mainGroup.appendChild(g);
        }

        // Lógica de Lotes (Igual à anterior)
        const l010A = lotes.find(l => l.id.endsWith('.010A'));
        const l0300 = lotes.find(l => l.id.endsWith('.0300'));
        const l0200 = lotes.find(l => l.id.endsWith('.0200'));

        let curX = OFF_X;
        lotes.filter(l => l.rua === 'AV. PARANA').sort((a,b) => b.num - a.num).forEach(l => {
            drawLote(curX, OFF_Y, l.t * ESC, l.p * ESC, l, 'N'); curX += l.t * ESC;
        });
        let curY = OFF_Y + (l010A.p * ESC);
        ['.0100', '.0800', '.0300'].forEach(sfx => {
            const l = lotes.find(item => item.id.endsWith(sfx));
            if(l) { drawLote(OFF_X, curY, l.p * ESC, l.t * ESC, l, 'W'); curY += l.t * ESC; }
        });
        const posX_Leste = curX; 
        let curY_Leste = OFF_Y + (l0200.p * ESC);
        ['.020A', '.0900', '.040A', '.04AA'].forEach(sfx => {
            const l = lotes.find(item => item.id.endsWith(sfx));
            if(l) { drawLote(posX_Leste - (l.p * ESC), curY_Leste, l.p * ESC, l.t * ESC, l, 'E'); curY_Leste += l.t * ESC; }
        });
        let sulX = OFF_X + (l0300.p * ESC);
        lotes.filter(l => l.rua === 'RUA SANTA CATARINA' && !l.id.endsWith('.0400'))
             .sort((a,b) => b.num - a.num).forEach(l => {
                drawLote(sulX, curY - (l.p * ESC), l.t * ESC, l.p * ESC, l, 'S'); sulX += l.t * ESC;
             });
        const l0400 = lotes.find(l => l.id.endsWith('.0400'));
        drawLote(posX_Leste - (l0400.t * ESC), curY - (l0400.p * ESC), l0400.t * ESC, l0400.p * ESC, l0400, 'S');

        // POSICIONAMENTO DA ROSA DOS VENTOS (Ajustado para o giro de 15°)
        rosa.setAttribute("transform", `translate(${posX_Leste + 100}, ${curY - 20})`);

        // Labels
        const realW = curX - OFF_X; const realH = curY - OFF_Y;
        function drawLabel(x, y, txt, cls, rot = 0) {
            const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t.setAttribute("class", cls);
            if(rot !== 0) t.setAttribute("transform", `translate(${x},${y}) rotate(${rot})`);
            else { t.setAttribute("x", x); t.setAttribute("y", y); }
            t.textContent = txt; mainGroup.appendChild(t);
        }
        drawLabel(OFF_X + realW/2, OFF_Y - 15, `${(realW/ESC).toFixed(2)}m`, "quadra-dim-total");
        drawLabel(OFF_X + realW/2, OFF_Y - 35, "Av. Paraná", "rua-label");
        drawLabel(OFF_X + realW/2, curY + 30, `${(realW/ESC).toFixed(2)}m`, "quadra-dim-total");
        drawLabel(OFF_X + realW/2, curY + 50, "Rua Santa Catarina", "rua-label");
        drawLabel(OFF_X - 45, OFF_Y + realH/2, `${(realH/ESC).toFixed(2)}m`, "quadra-dim-total", -90);
        drawLabel(OFF_X - 65, OFF_Y + realH/2, "Av. Ubirajaras", "rua-label", -90);
        drawLabel(posX_Leste + 55, OFF_Y + realH/2, `${(realH/ESC).toFixed(2)}m`, "quadra-dim-total", 90);
        drawLabel(posX_Leste + 75, OFF_Y + realH/2, "Rua Caramurus", "rua-label", 90);
    }

    window.onload = render;
    window.onresize = () => { document.getElementById('mainGroup').innerHTML = ''; render(); };
</script>
</body>
</html>